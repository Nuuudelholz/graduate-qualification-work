<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Занятость аудиторий УУНиТ</title>
    <meta name="csrf-token" content="{{ csrf_token }}">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />

    <link rel="stylesheet" href="{% static 'css/charts.css' %}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
<header>
    <div class="head">
        <img class="logo" src="{% static 'img/logo.png' %}" alt="Логотип">
        <div class="title">Занятость аудиторий УУНиТ онлайн</div>
    </div>
</header>

<main>
    <div class="buttons">
        <div class="selectors">
            <div class="fileSelector">
                <div class="SelectorText">Корпус</div>
                <select class="fileSelect" id="fileSelect">
                    <option value="">Номер корпуса</option>
                    <option value="1_Корпус" disabled>1_Корпус</option>
                    <option value="2_Корпус" disabled>2_Корпус</option>
                    <option value="3_Корпус" disabled>3_Корпус</option>
                    <option value="4_Корпус" disabled>4_Корпус</option>
                    <option value="5_Корпус" disabled>5_Корпус</option>
                    <option value="7_Корпус" disabled>7_Корпус</option>
                    <option value="8_Корпус" disabled>8_Корпус</option>
                </select>
            </div>

            <div class="weekSelector">
                <div class="SelectorText">Номер недели</div>
                <select class="weekSelect" id="weekSelect">
                    <option value="">Номер недели</option>
                    <script>
                        for (let i = 23; i <= 41; i++) {
                            document.write(`<option value="${i}">${i}</option>`);
                        }
                    </script>
                </select>
            </div>
            <div class="daySelector">
                <div class="SelectorText">День недели</div>
                <select class="daySelect" id="daySelect">
                    <option value="">День недели</option>
                    <option value="Понедельник">Понедельник</option>
                    <option value="Вторник">Вторник</option>
                    <option value="Среда">Среда</option>
                    <option value="Четверг">Четверг</option>
                    <option value="Пятница">Пятница</option>
                    <option value="Суббота">Суббота</option>
                </select>
            </div>
        </div>
        <div class="floorSelector">
            <div class="SelectorText">Этаж</div>
            <div class="floorSelect">
                <button class="floor_btn" onclick="filterLayer(1); updateFloorText('Э-1')">Э-1</button>
                <button class="floor_btn" onclick="filterLayer(2); updateFloorText('Э-2')">Э-2</button>
                <button class="floor_btn" onclick="filterLayer(3); updateFloorText('Э-3')">Э-3</button>
                <button class="floor_btn" onclick="filterLayer(4); updateFloorText('Э-4')">Э-4</button>
                <button class="floor_btn" onclick="filterLayer(5); updateFloorText('Э-5')">Э-5</button>
                <button class="analyze-btn" id="analyze-btn" onclick="analyzeOccupancy()">Анализ занятости</button>
            </div>
        </div>

    </div>
    <div class="buttons2">
        <button class="time_btn" onclick="test(); updateTimeText('08:00-09:20')">08:00-09:20</button>
        <button class="time_btn" onclick="test(); updateTimeText('09:35-10:55')">09:35-10:55</button>
        <button class="time_btn" onclick="test(); updateTimeText('11:35-12:55')">11:35-12:55</button>
        <button class="time_btn" onclick="test(); updateTimeText('13:10-14:30')">13:10-14:30</button>
        <button class="time_btn" onclick="test(); updateTimeText('15:10-16:30')">15:10-16:30</button>
        <button class="time_btn" onclick="test(); updateTimeText('16:45-18:05')">16:45-18:05</button>
        <button class="time_btn" onclick="test(); updateTimeText('18:20-19:40')">18:20-19:40</button>
    </div>

    <div class="legend">
        <button class="showLegend" id="showLegend"><</button>
    </div>

    <div class="selectedContent">
        <div class="selectedBuildingText" id="selectedBuildingText">Корпус: не выбран</div>
        <div class="selectedWeekText" id="selectedWeekText">Неделя: не выбрана</div>
        <div class="selectedDayText" id="selectedDayText">День: не выбран</div>
        <div class="selectedFloorText" id="selectedFloorText">Этаж: не выбран</div>
        <div class="selectedTimeText" id="selectedTimeText">Время: не выбрано</div>
    </div>

    <div class="sideMenu" id="sideMenu">
        <div class="legendContent">
            <div class="contentOpen">
                <div class="iconOpen"> </div>
                <div class="textOpen">- Свободная аудитория</div>
            </div>
            <div class="contentClose">
                <div class="iconClose"> </div>
                <div class="textClose">- Занятая аудитория</div>
            </div>
            <div class="contentPrivate">
                <div class="iconPrivate"> </div>
                <div class="textPrivate">- Неучебное помещение</div>
            </div>

        </div>
    </div>

    <div class="analysis-section" id="analysis-section">
        <div class="closeOccupancy" id="closeOccupancy">X</div>
        <div id="occupancy-results" class="occupancy-results">
            {% for item in occupancy_list %}
                <div class="result-item">{{ item }}</div>
            {% endfor %}
        </div>
        <div id="chart-container" class="chart-container">
            <canvas id="occupancy-chart" width="400" height="200"></canvas>
        </div>
    </div>

    <div id="map"></div>
</main>

<script src="{% static 'js/sideMenu.js' %}"></script>
<script src="{% static 'js/script.js' %}"></script>
<script src="{% static 'js/geojson.js' %}"></script>
<script src="{% static 'js/selectedContentUpdater.js' %}"></script>
<script src="{% static 'js/occupancy.js' %}"></script>
<script>
    const chartData = {{ chart_data|safe }};
    if (chartData.rooms.length) {
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('occupancy-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.rooms,
                    datasets: [{
                        label: 'Количество занятий',
                        data: chartData.counts,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    }
</script>
</body>
</html>